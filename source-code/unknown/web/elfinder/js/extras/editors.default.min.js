!function(e,t){if("function"==typeof define&&define.amd)define(["elfinder"],e);else if(t){var i=t.prototype._options.commandsOptions.edit.editors;t.prototype._options.commandsOptions.edit.editors=i.concat(e(t))}}(function(e){"use strict";var t,i=window.location.search.match(/getfile=([a-z]+)/),n=e.prototype.hasRequire,a={bmp:"image/x-ms-bmp",dng:"image/x-adobe-dng",gif:"image/gif",jpeg:"image/jpeg",jpg:"image/jpeg",pdf:"application/pdf",png:"image/png",ppm:"image/x-portable-pixmap",psd:"image/vnd.adobe.photoshop",pxd:"image/x-pixlr-data",svg:"image/svg+xml",tiff:"image/tiff",webp:"image/webp",xcf:"image/x-xcf",sketch:"application/x-sketch",url:"text/url"},o=function(e,i,n){t||(t=i.arrayFlip(a));var o=t[e]||i.mimeTypes[e];return n?"jpg"===o&&(o="jpeg"):"jpeg"===o&&(o="jpg"),o};return i&&(i=i[1],"ckeditor"===i&&(e.prototype._options.getFileCallback=function(e,t){window.opener.CKEDITOR.tools.callFunction(function(){var e=new RegExp("(?:[?&]|&amp;)CKEditorFuncNum=([^&]+)","i"),t=window.location.search.match(e);return t&&t.length>1?t[1]:""}(),t.convAbsUrl(e.url)),t.destroy(),window.close()})),[{info:{id:"tuiimgedit",name:"TUI Image Editor",iconImg:"img/editor-icons.png 0 -48",dataScheme:!0,schemeContent:!0,openMaximized:!0,canMakeEmpty:!1,integrate:{title:"TOAST UI Image Editor",link:"http://ui.toast.com/tui-image-editor/"}},mimes:["image/jpeg","image/png","image/gif","image/svg+xml","image/x-ms-bmp"],html:'<div class="elfinder-edit-imageeditor"><canvas></canvas></div>',setup:function(e,t){t.UA.ltIE8||t.UA.Mobile?this.disabled=!0:(this.opts=Object.assign({version:"v3.15.3"},e.extraOptions.tuiImgEditOpts||{},{iconsPath:t.baseUrl+"img/tui-",theme:{}}),t.isSameOrigin(this.opts.iconsPath)||(this.disabled=!0,t.debug("warning","Setting `commandOptions.edit.extraOptions.tuiImgEditOpts.iconsPath` MUST follow the same origin policy.")))},init:function(e,t,i,n){console.log("TUI1",i),this.data("url",i)},load:function(e){var t,i=this,n=this.fm,a=$.Deferred(),o=n.options.cdns,r=i.confObj.opts.version,s=function(t){console.log("TUI2",$(e).data("url"));var o,r,s,c,d,l=$(e),p=l.parent(),m=i.confObj.opts,u=(m.iconsPath,$('<div class="tui-image-editor-container">').appendTo(p)),g=[$('<div class="tui-image-editor-submenu"></div>').appendTo(u),$('<div class="tui-image-editor-controls"></div>').appendTo(u)],f=new t(e,{includeUI:{loadImage:{path:l.data("url"),name:i.file.name},theme:m.theme,initMenu:"filter",menuBarPosition:"bottom"},cssMaxWidth:Math.max(300,p.width()),cssMaxHeight:Math.max(200,p.height()-(g[0].height()+g[1].height()+3)),usageStatistics:!1}),h=l.find("canvas:first").get(0),b=function(e){if("undefined"!=typeof e){var t,i,n,a=$(h),r=parseInt(a.attr("width")),s=parseInt(a.attr("height")),c=r/s;0===e?(i=r,n=s):(i=parseInt(a.css("max-width"))+Number(e),n=i/c,i>r&&n>s&&(i=r,n=s)),t=Math.round(i/r*100),t<100?(f.resetZoom(),f.stopDrawingMode(),o.hide()):o.show(),w.text(t+"%"),f.resizeCanvasDimension({width:i,height:n}),d&&setTimeout(function(){d&&b(e)},50)}},v=$('<span class="ui-icon ui-icon-plusthick"></span>').data("val",10),x=$('<span class="ui-icon ui-icon-minusthick"></span>').data("val",-10),w=$("<button></button>").css("width","4em").text("%").attr("title","100%").data("val",0);u.remove(),l.removeData("url").data("mime",i.file.mime),"image/jpeg"===i.file.mime?(l.data("quality",n.storage("jpgQuality")||n.option("jpgQuality")),r=$('<input type="number" class="ui-corner-all elfinder-resize-quality elfinder-tabstop"/>').attr("min","1").attr("max","100").attr("title","1 - 100").on("change",function(){var e=r.val();l.data("quality",e),s&&cancelAnimationFrame(s),s=requestAnimationFrame(function(){h.toBlob(function(e){e&&r.next("span").text(" ("+n.formatSize(e.size)+")")},"image/jpeg",Math.max(Math.min(e,100),1)/100)})}).val(l.data("quality")),$('<div class="ui-dialog-buttonset elfinder-edit-extras elfinder-edit-extras-quality"></div>').append($("<span>").html(n.i18n("quality")+" : "),r,$("<span></span>")).prependTo(l.parent().next())):"image/svg+xml"===i.file.mime&&l.closest(".ui-dialog").trigger("changeType",{extention:"png",mime:"image/png",keepEditor:!0}),$('<div class="ui-dialog-buttonset elfinder-edit-extras"></div>').append(x,w,v).attr("title",n.i18n("scale")).on("click","span,button",function(){b($(this).data("val"))}).on("mousedown mouseup mouseleave","span",function(e){d=!1,c&&clearTimeout(c),"mousedown"===e.type&&(c=setTimeout(function(){d=!0,b($(e.target).data("val"))},500))}).prependTo(l.parent().next()),setTimeout(function(){a.resolve(f),r&&(r.trigger("change"),f.on("redoStackChanged undoStackChanged",function(){r.trigger("change")})),o=l.find(".tie-btn-zoomIn,.tie-btn-zoomOut,.tie-btn-hand"),b(null)},100),l.find(".tui-colorpicker-palette-container").on("click",".tui-colorpicker-palette-preview",function(){$(this).closest(".color-picker-control").height("auto").find(".tui-colorpicker-slider-container").toggle()}),l.on("click",function(){l.find(".tui-colorpicker-slider-container").hide()})};return i.confObj.editor?s(i.confObj.editor):(t=$.Deferred(),n.loadCss([o.tui+"/tui-color-picker/latest/tui-color-picker.css",o.tui+"/tui-image-editor/"+r+"/tui-image-editor.css"]),n.hasRequire?(require.config({paths:{"fabric/dist/fabric.require":o.fabric+"/fabric.require.min",fabric:o.fabric+"/fabric.min","tui-code-snippet":o.tui+"/tui.code-snippet/latest/tui-code-snippet.min","tui-color-picker":o.tui+"/tui-color-picker/latest/tui-color-picker.min","tui-image-editor":o.tui+"/tui-image-editor/"+r+"/tui-image-editor.min"}}),require(["tui-image-editor"],function(e){t.resolve(e)})):n.loadScript([o.fabric+"/fabric.min.js",o.tui+"/tui.code-snippet/latest/tui-code-snippet.min.js"],function(){n.loadScript([o.tui+"/tui-color-picker/latest/tui-color-picker.min.js"],function(){n.loadScript([o.tui+"/tui-image-editor/"+r+"/tui-image-editor.min.js"],function(){t.resolve(window.tui.ImageEditor)},{loadType:"tag"})},{loadType:"tag"})},{loadType:"tag"}),t.done(function(e){i.confObj.editor=e,s(e)})),a},getContent:function(e){var t=this.editor,i=t.fm,n=$(e),a=n.data("quality");if(t.instance)return"image/jpeg"===n.data("mime")&&(a=a||i.storage("jpgQuality")||i.option("jpgQuality"),a=Math.max(.1,Math.min(1,a/100))),t.instance.toDataURL({format:o(n.data("mime"),i,!0),quality:a})},save:function(e){var t,i=$(e),n=i.data("quality"),a=i.data("hash");this.instance.deactivateAll(),"undefined"!=typeof n&&this.fm.storage("jpgQuality",n),a&&(t=this.fm.file(a),i.data("mime",t.mime))}},{info:{id:"photopea",name:"Photopea",iconImg:"img/editor-icons.png 0 -160",single:!0,noContent:!0,arrayBufferContent:!0,openMaximized:!0,canMakeEmpty:["image/jpeg","image/png","image/gif","image/svg+xml","image/x-ms-bmp","image/webp","application/pdf"],integrate:{title:"Photopea",link:"https://www.photopea.com/learn/"}},mimes:["image/jpeg","image/png","image/gif","image/svg+xml","image/x-ms-bmp","image/tiff","image/x-adobe-dng","image/webp","image/x-xcf","image/vnd.adobe.photoshop","application/pdf","image/x-portable-pixmap","image/x-sketch"],html:'<iframe style="width:100%;height:100%;border:none;"></iframe>',setup:function(e,t){(t.UA.IE||t.UA.Mobile)&&(this.disabled=!0)},init:function(e,t,i,n){var r,s,c,d="https://www.photopea.com",l=$(this).hide().on("load",function(){l.show()}).on("error",function(){u.remove(),l.show()}),p=this.editor,m=p.confObj,u=$('<div class="elfinder-edit-spinner elfinder-edit-photopea"></div>').html('<span class="elfinder-spinner-text">'+n.i18n("nowLoading")+'</span><span class="elfinder-spinner"></span>').appendTo(l.parent()),g=n.arrayFlip(m.info.canMakeEmpty),f=function(e){var t=o(e,n),i=a[t];return m.mimesFlip[i]?"jpeg"===t&&(t="jpg"):t="",t&&g[i]||(t="psd",i=a[t],l.closest(".ui-dialog").trigger("changeType",{extention:t,mime:i,keepEditor:!0})),t},h=t.mime;m.mimesFlip||(m.mimesFlip=n.arrayFlip(m.mimes,!0)),m.liveMsg||(m.liveMsg=function(e,t,i){var a,o=e.get(0).contentWindow,r=0,s=null,c=$.Deferred().done(function(){t.remove(),r=1,o.postMessage(s,d)});this.load=function(){return n.getContents(i.hash,"arraybuffer").done(function(e){s=e})},this.receive=function(t){var i=t.originalEvent;i.origin===d&&i.source===o&&("done"===i.data?0===r?c.resolve():1===r?(r=2,e.trigger("contentsloaded")):a&&"pending"===a.state()&&a.reject("errDataEmpty"):"Save"===i.data?p.doSave():a&&"pending"===a.state()&&("object"==typeof i.data?a.resolve("data:"+h+";base64,"+n.arrayBufferToBase64(i.data)):a.reject("errDataEmpty")))},this.getContent=function(){var t,i;if(r>1)return a&&"pending"===a.state()&&a.reject(),a=null,a=$.Deferred(),2===r?(r=3,a.resolve("data:"+h+";base64,"+n.arrayBufferToBase64(s)),s=null,a):(e.data("mime")&&(h=e.data("mime"),t=f(h)),(i=e.data("quality"))&&(t+=":"+i/100),o.postMessage('app.activeDocument.saveToOE("'+t+'")',d),a)}}),l.parent().css("padding",0),s=f(t.mime),r=p.liveMsg=new m.liveMsg(l,u,t),$(window).on("message."+n.namespace,r.receive),r.load().done(function(){var e=JSON.stringify({files:[],environment:{lang:n.lang.replace(/_/g,"-"),customIO:{save:'app.echoToOE("Save");'}}});l.attr("src",d+"/#"+encodeURI(e))}).fail(function(e){e&&n.error(e),p.initFail=!0}),"image/jpeg"!==t.mime&&"image/webp"!==t.mime||(l.data("quality",n.storage("jpgQuality")||n.option("jpgQuality")),c=$('<input type="number" class="ui-corner-all elfinder-resize-quality elfinder-tabstop"/>').attr("min","1").attr("max","100").attr("title","1 - 100").on("change",function(){var e=c.val();l.data("quality",e)}).val(l.data("quality")),$('<div class="ui-dialog-buttonset elfinder-edit-extras elfinder-edit-extras-quality"></div>').append($("<span>").html(n.i18n("quality")+" : "),c,$("<span></span>")).prependTo(l.parent().next()))},load:function(e){var t=$.Deferred(),i=this,n=(this.fm,$(e));return i.initFail?t.reject():n.on("contentsloaded",function(){t.resolve(i.liveMsg)}),t},getContent:function(){return this.editor.liveMsg?this.editor.liveMsg.getContent():void 0},save:function(e,t){var i,n=$(e),a=n.data("quality"),o=n.data("hash");"undefined"!=typeof a&&this.fm.storage("jpgQuality",a),o?(i=this.fm.file(o),n.data("mime",i.mime)):n.removeData("mime")},close:function(e,t){$(e).attr("src",""),t&&$(window).off("message."+this.fm.namespace,t.receive)}},{setup:function(e,t){!t.UA.ltIE8&&t.options.cdns.ace||(this.disabled=!0)},info:{id:"aceeditor",name:"ACE Editor",iconImg:"img/editor-icons.png 0 -96"},load:function(e){var t=this,i=this.fm,n=$.Deferred(),a=i.options.cdns.ace,o=function(){var i,o,r,s=$(e),c=s.parent(),d=c.parent(),l=e.id+"_ace",p=(t.file.name.replace(/^.+\.([^.]+)|(.+)$/,"$1$2").toLowerCase(),{"text/x-php":"php","application/x-php":"php","text/html":"html","application/xhtml+xml":"html","text/javascript":"javascript","application/javascript":"javascript","text/css":"css","text/x-c":"c_cpp","text/x-csrc":"c_cpp","text/x-chdr":"c_cpp","text/x-c++":"c_cpp","text/x-c++src":"c_cpp","text/x-c++hdr":"c_cpp","text/x-shellscript":"sh","application/x-csh":"sh","text/x-python":"python","text/x-java":"java","text/x-java-source":"java","text/x-ruby":"ruby","text/x-perl":"perl","application/x-perl":"perl","text/x-sql":"sql","text/xml":"xml","application/docbook+xml":"xml","application/xml":"xml"});c.height(c.height()),ace.config.set("basePath",a),o=$('<div id="'+l+'" style="width:100%; height:100%;"></div>').text(s.val()).insertBefore(s.hide()),s.data("ace",!0),i=ace.edit(l),i.$blockScrolling=1/0,i.setOptions({theme:"ace/theme/monokai",fontSize:"14px",wrap:!0}),ace.config.loadModule("ace/ext/modelist",function(){r=ace.require("ace/ext/modelist").getModeForPath("/"+t.file.name).name,"text"===r&&p[t.file.mime]&&(r=p[t.file.mime]),c.prev().children(".elfinder-dialog-title").append(" ("+t.file.mime+" : "+r.split(/[\/\\]/).pop()+")"),i.setOptions({mode:"ace/mode/"+r}),"resolved"===n.state()&&d.trigger("resize")}),ace.config.loadModule("ace/ext/language_tools",function(){ace.require("ace/ext/language_tools"),i.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!1})}),ace.config.loadModule("ace/ext/settings_menu",function(){ace.require("ace/ext/settings_menu").init(i)}),i.commands.addCommand({name:"saveFile",bindKey:{win:"Ctrl-s",mac:"Command-s"},exec:function(e){t.doSave()}}),i.commands.addCommand({name:"closeEditor",bindKey:{win:"Ctrl-w|Ctrl-q",mac:"Command-w|Command-q"},exec:function(e){t.doCancel()}}),i.resize(),$('<div class="ui-dialog-buttonset"></div>').css("float","left").append($("<button></button>").html(t.fm.i18n("TextArea")).button().on("click",function(){s.data("ace")?(s.removeData("ace"),o.hide(),s.val(i.session.getValue()).show().trigger("focus"),$(this).text("AceEditor")):(s.data("ace",!0),o.show(),i.setValue(s.hide().val(),-1),i.focus(),$(this).html(t.fm.i18n("TextArea")))})).append($("<button>Ace editor setting</button>").button({icons:{primary:"ui-icon-gear",secondary:"ui-icon-triangle-1-e"},text:!1}).on("click",function(){i.showSettingsMenu(),$("#ace_settingsmenu").css("font-size","80%").find('div[contains="setOptions"]').hide().end().parent().appendTo($("#elfinder"))})).prependTo(c.next()),t.trigger("Prepare",{node:e,editorObj:ace,instance:i,opts:{}}),n.resolve(i)};return t.confObj.loader||(t.confObj.loader=$.Deferred(),t.fm.loadScript([a+"/ace.js"],function(){t.confObj.loader.resolve()},void 0,{obj:window,name:"ace"})),t.confObj.loader.done(o),n},close:function(e,t){t&&t.destroy()},save:function(e,t){t&&$(e).data("ace")&&(e.value=t.session.getValue())},focus:function(e,t){t&&$(e).data("ace")&&t.focus()},resize:function(e,t,i,n){t&&t.resize()}},{setup:function(e,t){!t.UA.ltIE10&&t.options.cdns.simplemde||(this.disabled=!0)},info:{id:"simplemde",name:"SimpleMDE",iconImg:"img/editor-icons.png 0 -80"},exts:["md"],load:function(e){var t=this,i=this.fm,a=$(e).parent(),o=$.Deferred(),r=i.options.cdns.simplemde,s=function(i){var n,r,s,c=a.height(),d=a.outerHeight(!0)-c+14;e._setHeight=function(e){var t,i=e||a.height(),o=0;return a.children(".editor-toolbar,.editor-statusbar").each(function(){o+=$(this).outerHeight(!0)}),t=i-o-d,r.height(t),n.codemirror.refresh(),t},a.height(c),s={element:e,autofocus:!0},t.trigger("Prepare",{node:e,editorObj:i,instance:void 0,opts:s}),n=new i(s),o.resolve(n),r=$(n.codemirror.getWrapperElement()),r.css("min-height","50px").children(".CodeMirror-scroll").css("min-height","50px"),e._setHeight(c)};return t.confObj.loader||(t.confObj.loader=$.Deferred(),t.fm.loadCss(r+"/simplemde.min.css"),n?require([r+"/simplemde.min.js"],function(e){t.confObj.loader.resolve(e)}):t.fm.loadScript([r+"/simplemde.min.js"],function(){t.confObj.loader.resolve(SimpleMDE)},{loadType:"tag"})),t.confObj.loader.done(s),o},close:function(e,t){t&&t.toTextArea(),t=null},save:function(e,t){t&&(e.value=t.value())},focus:function(e,t){t&&t.codemirror.focus()},resize:function(e,t,i,n){t&&e._setHeight()}},{info:{id:"ckeditor",name:"CKEditor",iconImg:"img/editor-icons.png 0 0"},exts:["htm","html","xhtml"],setup:function(e,t){var i=this;t.options.cdns.ckeditor?(i.ckeOpts={},e.extraOptions&&(i.ckeOpts=Object.assign({},e.extraOptions.ckeditor||{}),e.extraOptions.managerUrl&&(i.managerUrl=e.extraOptions.managerUrl))):i.disabled=!0},load:function(e){var t=this,i=this.fm,n=$.Deferred(),a=function(){var a,o=$(e).parent(),r=o.closest(".elfinder-dialog"),s=o.height(),c=/([&?]getfile=)[^&]+/,d=t.confObj.managerUrl||window.location.href.replace(/#.*$/,""),l="ckeditor";c.test(d)?d=d.replace(c,"$1"+l):d+="?getfile="+l,o.height(s),a={startupFocus:!0,fullPage:!0,allowedContent:!0,filebrowserBrowseUrl:d,toolbarCanCollapse:!0,toolbarStartupExpanded:!i.UA.Mobile,removePlugins:"resize",extraPlugins:"colorbutton,justify",on:{instanceReady:function(a){var o=a.editor;o.resize("100%",s),r.one("beforedommove."+i.namespace,function(){o.destroy()}).one("dommove."+i.namespace,function(){t.load(e).done(function(e){t.instance=e})}),n.resolve(a.editor)}}},t.trigger("Prepare",{node:e,editorObj:CKEDITOR,instance:void 0,opts:a}),CKEDITOR.replace(e.id,Object.assign(a,t.confObj.ckeOpts)),CKEDITOR.on("dialogDefinition",function(e){var t=e.data.definition.dialog;t.on("show",function(e){i.getUI().append($(".cke_dialog_background_cover")).append(this.getElement().$)}),t.on("hide",function(e){$("body:first").append($(".cke_dialog_background_cover")).append(this.getElement().$)})})};return t.confObj.loader||(t.confObj.loader=$.Deferred(),window.CKEDITOR_BASEPATH=i.options.cdns.ckeditor,$.getScript(i.options.cdns.ckeditor+"ckeditor.js",function(){t.confObj.loader.resolve()})),t.confObj.loader.done(a),n},close:function(e,t){t&&t.destroy()},save:function(e,t){t&&(e.value=t.getData())},focus:function(e,t){t&&t.focus()},resize:function(e,t,i,n){t&&"ready"===t.status&&t.resize("100%",$(e).parent().height())}},{info:{id:"ckeditor5",name:"CKEditor5",iconImg:"img/editor-icons.png 0 -16"},exts:["htm","html","xhtml"],html:'<div class="edit-editor-ckeditor5"></div>',setup:function(e,t){var i=this;t.options.cdns.ckeditor5&&"function"==typeof window.Symbol&&"symbol"==typeof Symbol()?(i.ckeOpts={},e.extraOptions&&(e.extraOptions.ckeditor5Mode&&(i.ckeditor5Mode=e.extraOptions.ckeditor5Mode),i.ckeOpts=Object.assign({},e.extraOptions.ckeditor5||{}),i.ckeOpts.mode&&(i.ckeditor5Mode=i.ckeOpts.mode,delete i.ckeOpts.mode),e.extraOptions.managerUrl&&(i.managerUrl=e.extraOptions.managerUrl))):i.disabled=!0,t.bind("destroy",function(){i.editor=null})},prepare:function(e,t,i){$(e).height(e.editor.fm.getUI().height()-100)},init:function(e,t,i,n){var a=i.match(/^([\s\S]*<body[^>]*>)([\s\S]+)(<\/body>[\s\S]*)$/i),o="",r="",s="";this.css({width:"100%",height:"100%","box-sizing":"border-box"}),a?(o=a[1],r=a[2],s=a[3]):r=i,this.data("data",{header:o,body:r,footer:s})},load:function(e){var t,i=this,n=this.fm,a=$.Deferred(),o=i.confObj.ckeditor5Mode||"decoupled-document",r=function(){var e=n.lang.toLowerCase().replace("_","-");return"zh"===e.substr(0,2)&&"zh-cn"!==e&&(e="zh"),e}(),s=function(t){var s,d=$(e).parent();d.height(n.getUI().height()-100),s=Object.assign({toolbar:["undo","redo","alignment","fontSize","fontFamily","highlight","bold","italic","strikethrough","underline","blockQuote","ckfinder","imageTextAlternative","imageUpload","heading","indent","outdent","link","numberedList","bulletedList","mediaEmbed","insertTable","tableColumn","tableRow","mergeTableCells"],language:r},i.confObj.ckeOpts),i.trigger("Prepare",{node:e,editorObj:t,instance:void 0,opts:s}),t.create(e,s).then(function(t){var i,r,s=t.commands.get("ckfinder"),l=t.plugins.get("FileRepository"),p={};!t.ui.view.toolbar||"classic"!==o&&"decoupled-document"!==o||$(e).closest(".elfinder-dialog").children(".ui-widget-header").append($(t.ui.view.toolbar.element).css({marginRight:"-1em",marginLeft:"-1em"})),"classic"===o&&$(e).closest(".elfinder-edit-editor").css("overflow","auto"),s&&(i=function(e){return e&&e.mime.match(/^image\//i)},r=function(e){var i=t.commands.get("imageUpload");if(!i.isEnabled){var n=t.plugins.get("Notification"),a=t.locale.t;return void n.showWarning(a("Could not insert image at the current position."),{title:a("Inserting image failed"),namespace:"ckfinder"})}t.execute("imageInsert",{source:e})},s.execute=function(){var e=d.closest(".elfinder-dialog"),a=n.getCommand("getfile"),o=function(){p.hasVar&&(e.off("resize close",o),a.callback=p.callback,a.options.folders=p.folders,a.options.multiple=p.multi,n.commandMap.open=p.open,p.hasVar=!1)};e.trigger("togleminimize").one("resize close",o),p.callback=a.callback,p.folders=a.options.folders,p.multi=a.options.multiple,p.open=n.commandMap.open,p.hasVar=!0,a.callback=function(a){var o=[];return 1===a.length&&"directory"===a[0].mime?void n.one("open",function(){n.commandMap.open="getfile"}).getCommand("open").exec(a[0].hash):(n.getUI("cwd").trigger("unselectall"),$.each(a,function(e,a){i(a)?o.push(n.convAbsUrl(a.url)):t.execute("link",n.convAbsUrl(a.url))}),o.length&&r(o),void e.trigger("togleminimize"))},a.options.folders=!0,a.options.multiple=!0,n.commandMap.open="getfile",n.toast({mode:"info",msg:n.i18n("dblclickToSelect")})}),l.createUploadAdapter=function(e){return new c(e)},t.setData($(e).data("data").body),n.getUI().append($("body > div.ck-body")),$("div.ck-balloon-panel").css({"z-index":n.getMaximizeCss().zIndex+1}),a.resolve(t)})["catch"](function(e){n.error(e)})},c=function(e){var t=function(t,i,a){n.exec("upload",{files:[t]},void 0,n.cwd().hash).done(function(e){e.added&&e.added.length?n.url(e.added[0].hash,{async:!0}).done(function(e){i({"default":n.convAbsUrl(e)})}).fail(function(){a("errFileNotFound")}):a(n.i18n(e.error?e.error:"errUpload"))}).fail(function(e){var t=n.parseError(e);a(n.i18n(t?"userabort"===t?"errAbort":t:"errUploadNoFiles"))}).progress(function(t){e.uploadTotal=t.total,e.uploaded=t.progress})};this.upload=function(){return new Promise(function(i,n){e.file instanceof Promise||e.file&&"function"==typeof e.file.then?e.file.then(function(e){t(e,i,n)}):t(e.file,i,n)})},this.abort=function(){n.getUI().trigger("uploadabort")}};return i.confObj.editor?s(i.confObj.editor):(t=$.Deferred(),i.fm.loadScript([n.options.cdns.ckeditor5+"/"+o+"/ckeditor.js"],function(e){e||(e=window.BalloonEditor||window.InlineEditor||window.ClassicEditor||window.DecoupledEditor),"en"!==n.lang?i.fm.loadScript([n.options.cdns.ckeditor5+"/"+o+"/translations/"+r+".js"],function(i){t.resolve(e)},{tryRequire:!0,loadType:"tag",error:function(i){r="en",t.resolve(e)}}):t.resolve(e)},{tryRequire:!0,loadType:"tag"}),t.done(function(e){i.confObj.editor=e,s(e)})),a},getContent:function(){var e=$(this).data("data");return e.header+e.body+e.footer},close:function(e,t){t&&t.destroy()},save:function(e,t){var i=$(e),n=i.data("data");t&&(n.body=t.getData(),i.data("data",n))},focus:function(e,t){$(e).trigger("focus")}},{info:{id:"tinymce",name:"TinyMCE",iconImg:"img/editor-icons.png 0 -64"},exts:["htm","html","xhtml"],setup:function(e,t){var i=this;t.options.cdns.tinymce?(i.mceOpts={},e.extraOptions?(i.uploadOpts=Object.assign({},e.extraOptions.uploadOpts||{}),i.mceOpts=Object.assign({},e.extraOptions.tinymce||{})):i.uploadOpts={}):i.disabled=!0},load:function(e){var t=this,i=this.fm,n=$.Deferred(),a=function(){var a,o,r,s=$(e).show().parent(),c=s.closest(".elfinder-dialog"),d=s.height(),l=s.outerHeight(!0)-d,p=function(){var e;tinymce.activeEditor.windowManager.windows?(e=tinymce.activeEditor.windowManager.windows[0],o=$(e?e.getEl():void 0).hide(),r=$("#mce-modal-block").hide()):o=$(".tox-dialog-wrap").hide()},m=function(){r&&r.show(),o&&o.show()},u=tinymce.majorVersion;s.height(d),e._setHeight=function(e){if(u<5){var t,i=$(this).parent(),n=e||i.innerHeight(),a=0;i.find(".mce-container-body:first").children(".mce-top-part,.mce-statusbar").each(function(){a+=$(this).outerHeight(!0)}),t=n-a-l,i.find(".mce-edit-area iframe:first").height(t)}},a={selector:"#"+e.id,resize:!1,plugins:"print preview fullpage searchreplace autolink directionality visualblocks visualchars fullscreen image link media template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists wordcount imagetools textpattern help",toolbar:"formatselect | bold italic strikethrough forecolor backcolor | link image media | alignleft aligncenter alignright alignjustify | numlist bullist outdent indent | removeformat",image_advtab:!0,init_instance_callback:function(a){e._setHeight(d),c.one("beforedommove."+i.namespace,function(){tinymce.execCommand("mceRemoveEditor",!1,e.id)}).one("dommove."+i.namespace,function(){t.load(e).done(function(e){t.instance=e})}),n.resolve(a)},file_picker_callback:function(e,t,n){var a=i.getCommand("getfile"),o=function(){r.hasVar&&(a.callback=r.callback,a.options.folders=r.folders,a.options.multiple=r.multi,i.commandMap.open=r.open,r.hasVar=!1),c.off("resize close",o),m()},r={};return r.callback=a.callback,r.folders=a.options.folders,r.multi=a.options.multiple,r.open=i.commandMap.open,r.hasVar=!0,a.callback=function(t){var a,o;return"directory"===t.mime?void i.one("open",function(){i.commandMap.open="getfile"}).getCommand("open").exec(t.hash):(a=i.convAbsUrl(t.url),o=t.name+" ("+i.formatSize(t.size)+")","file"==n.filetype&&e(a,{text:o,title:o}),"image"==n.filetype&&e(a,{alt:o}),"media"==n.filetype&&e(a),void c.trigger("togleminimize"))},a.options.folders=!0,a.options.multiple=!1,i.commandMap.open="getfile",p(),c.trigger("togleminimize").one("resize close",o),i.toast({mode:"info",msg:i.i18n("dblclickToSelect")}),!1},images_upload_handler:function(e,n,a){var o=e.blob(),r=function(e){var t=e.data.dialog||{};(t.hasClass("elfinder-dialog-error")||t.hasClass("elfinder-confirm-upload"))&&(p(),t.trigger("togleminimize").one("resize close",s),i.unbind("dialogopened",r))},s=function(){c.off("resize close",s),m()},d=!0;o.name&&(d=void 0),i.bind("dialogopened",r).exec("upload",Object.assign({files:[o],clipdata:d},t.confObj.uploadOpts),void 0,i.cwd().hash).done(function(e){e.added&&e.added.length?i.url(e.added[0].hash,{async:!0}).done(function(e){m(),n(i.convAbsUrl(e))}).fail(function(){a(i.i18n("errFileNotFound"))}):a(i.i18n(e.error?e.error:"errUpload"))}).fail(function(e){var t=i.parseError(e);t&&("errUnknownCmd"===t?t="errPerm":"userabort"===t&&(t="errAbort")),a(i.i18n(t?t:"errUploadNoFiles"))})}},u>=5&&(a.height="100%"),t.trigger("Prepare",{node:e,editorObj:tinymce,instance:void 0,opts:a}),tinymce.init(Object.assign(a,t.confObj.mceOpts))};return t.confObj.loader||(t.confObj.loader=$.Deferred(),t.fm.loadScript([i.options.cdns.tinymce+(i.options.cdns.tinymce.match(/\.js/)?"":"/tinymce.min.js")],function(){t.confObj.loader.resolve()},{loadType:"tag"})),t.confObj.loader.done(a),n},close:function(e,t){t&&tinymce.execCommand("mceRemoveEditor",!1,e.id)},save:function(e,t){t&&t.save()},focus:function(e,t){t&&t.focus()},resize:function(e,t,i,n){t&&e._setHeight()}},{info:{id:"textarea",name:"TextArea",useTextAreaEvent:!0},load:function(e){this.trigger("Prepare",{node:e,editorObj:void 0,instance:void 0,opts:{}}),e.setSelectionRange&&e.setSelectionRange(0,0),$(e).trigger("focus").show()},save:function(){}},{info:{id:"webpageparser",name:function(e){return e.i18n("enterWebPage")},dataScheme:!1,schemeContent:!1,openMaximized:!1,canMakeEmpty:!0},mimes:["text/url"],html:function(e){return'<div id="webpageparser-top"><table><tr><td>'+e.i18n("urlWebPage")+':</td><td><input type="text" id="webpageparser-url" placeholder="https://..." class="textbox"/></td></tr><tr><td>'+e.i18n("allowedDomains")+':</td><td><input type="text" id="webpageparser-allowedDomains" placeholder="'+e.i18n("allowedDomains1")+'" class="textbox"/><span class="tooltip"><span class="link">?</span><span class="tooltip-content">'+e.i18n("allowedDomains2")+"</span></span></td></tr><tr><td>"+e.i18n("webPageZoom")+':</td><td><input type="number" min="0" id="webpageparser-zoom" class="textbox" style="width:50px"/>%<span class="tooltip"><span class="link">?</span><span class="tooltip-content">'+e.i18n("webPageZoomHelp")+'</span></span></td></tr><tr><td><label for="webpageparser-hideProgressBar">'+e.i18n("hideProgressBar")+':</label></td><td><input type="checkbox" id="webpageparser-hideProgressBar"/><span class="tooltip"><span class="link">?</span><span class="tooltip-content">'+e.i18n("hideProgressBarHelp")+"</span></span></td></tr><tr><td>"+e.i18n("javascriptCode")+':</td><td><input type="text" id="webpageparser-javascript" class="textbox"/></td></tr></table><br>'+e.i18n("scanPage1")+'<input type="submit" value="'+e.i18n("scanPage")+'" id="webpageparser-load" class="ui-button ui-corner-all"/><div id="webpageparser-data"></div></div>'},load:function(e){var t=this.fm;$("#webpageparser-load").click(function(){$.ajax({url:"/ajax/webpageParser",data:{url:$("#webpageparser-url").val()},success:function(e){if(e.errorMessage)return void $("#webpageparser-data").html(t.i18n("errorLoadingWeb")+": "+e.errorMessage);var i=[];e.inputs.forEach(function(e){var t;if(e.id)t="document.getElementById(&quot;"+e.id+"&quot;)";else if(e.name)t="document.getElementsByName(&quot;"+e.name+"&quot;)[0]";else{if(!e.placeholder)return;t='document.querySelector(&quot;input[placeholder=\\"'+e.placeholder+'\\"]&quot;)'}var n=e.name?e.name:e.placeholder?e.placeholder:e.id;i.push($("<div>"+n+": <input type='text' class='webpageparser-input textbox' search='"+t+"'/></div>"))});var n=[],a=0;e.buttons.forEach(function(e){var t;e.id?t="document.getElementById(&quot;"+e.id+"&quot;)":e.name?t="document.getElementsByName(&quot;"+e.name+"&quot;)[0]":e.className&&(t="document.getElementsByClassName(&quot;"+e.className+"&quot;)[0]"),t&&(n.push($("<div><input type='radio' name='webpageparser-button' search='"+t+"' id='webpageparser-button"+a+"'/><label for='webpageparser-button"+a+"'>"+e.content+"</label></div>")),a++)}),$("#webpageparser-data").empty().append($("<div class='webpageparser-heading'>"+t.i18n("fillInputs")+":</div>")).append(i).append($("<div class='webpageparser-heading'>"+t.i18n("selectButton")+":</div>")).append(n)},error:function(e,i,n){$("#webpageparser-data").html(t.i18n("errorLoadingWeb")+": "+i+" "+e.status)}})})},init:function(e,t,i,n){i.split("\n").forEach(function(e){e.startsWith("URL=")?$("#webpageparser-url").val(e.substring(4)):e.startsWith("http://")||e.startsWith("https://")?$("#webpageparser-url").val(e):e.startsWith("JAVASCRIPT=")?$("#webpageparser-javascript").val(e.substring(11)):e.startsWith("ALLOWED_DOMAINS=")?$("#webpageparser-allowedDomains").val(e.substring(16)):e.startsWith("ZOOM=")?$("#webpageparser-zoom").val(e.substring(5)):e.startsWith("HIDE_PROGRESS_BAR=")&&$("#webpageparser-hideProgressBar").prop("checked","true"===e.substring(18))})},getContent:function(e){var t="URL="+document.getElementById("webpageparser-url").value+"\n",i=document.getElementById("webpageparser-javascript"),n=$("input[name=webpageparser-button]:checked");n.length&&(i.value="if ("+n.attr("search")+") { ",$("input.webpageparser-input").each(function(){var e=$(this);e.val()&&(i.value+=e.attr("search")+".value = '"+e.val()+"'; "+e.attr("search")+".dispatchEvent(new Event('focusout', {bubbles:true})); ")}),i.value+=n.attr("search")+".click(); }\n"),i.value&&(t+="JAVASCRIPT="+i.value+"\n");var a=document.getElementById("webpageparser-allowedDomains").value.trim();a&&(t+="ALLOWED_DOMAINS="+a+"\n");var o=document.getElementById("webpageparser-zoom").value;return o&&(t+="ZOOM="+o+"\n"),t+="HIDE_PROGRESS_BAR="+document.getElementById("webpageparser-hideProgressBar").checked},save:function(e){}}]},window.elFinder);
function setOnDimensionChange(t,e){var a=document.getElementById("dialog-"+t),i=document.getElementById("dialog-"+t+"-px");a.onchange=function(){i.value=Math.round(e*this.value/100)},i.onchange=function(){a.value=Math.round(100*this.value*100/e)/100}}function createPanelDiv(t,e){e.top=Math.round(100*e.top)/100,e.left=Math.round(100*e.left)/100,e.width=Math.round(100*e.width)/100,e.height=Math.round(100*e.height)/100,a=""===e.displayId?$(".layoutBuilder.mainDisplay"):$("#tabs-"+e.displayId+" .layoutBuilder");var a,i=$("<div class='panelDiv panelSnap'>"),d=(a.length&&i.appendTo(a),i.css("top",e.top+"%"),i.css("left",e.left+"%"),i.css("width",e.width+"%"),i.css("height",e.height+"%"),i.attr("data-top",e.top),i.attr("data-left",e.left),i.attr("data-width",e.width),i.attr("data-height",e.height),setPanelColor(i,e.backgroundColor),i.attr("title",e.name),i.attr("data-id",e.id),i.attr("data-main",e.main),i.attr("data-display-id",e.displayId),e.properties.ANIMATION_TYPE&&i.attr("data-animation-type",e.properties.ANIMATION_TYPE),e.properties.ANIMATION_LENGTH&&i.attr("data-animation-length",e.properties.ANIMATION_LENGTH),e.properties.STROKE_WIDTH&&(i.attr("data-stroke-width",e.properties.STROKE_WIDTH),i.css("outline-width",e.properties.STROKE_WIDTH/2+"px"),i.css("outline-offset",e.properties.STROKE_WIDTH/-2+"px"),i.css("outline-style","solid")),e.properties.STROKE_COLOR&&(i.attr("data-stroke-color",e.properties.STROKE_COLOR),i.css("outline-color",e.properties.STROKE_COLOR)),e.properties.RADIUS_TOP_LEFT&&(i.attr("data-radius-top-left",e.properties.RADIUS_TOP_LEFT),i.css("border-top-left-radius",e.properties.RADIUS_TOP_LEFT/2+"px")),e.properties.RADIUS_TOP_RIGHT&&(i.attr("data-radius-top-right",e.properties.RADIUS_TOP_RIGHT),i.css("border-top-right-radius",e.properties.RADIUS_TOP_RIGHT/2+"px")),e.properties.RADIUS_BOTTOM_LEFT&&(i.attr("data-radius-bottom-left",e.properties.RADIUS_BOTTOM_LEFT),i.css("border-bottom-left-radius",e.properties.RADIUS_BOTTOM_LEFT/2+"px")),e.properties.RADIUS_BOTTOM_RIGHT&&(i.attr("data-radius-bottom-right",e.properties.RADIUS_BOTTOM_RIGHT),i.css("border-bottom-right-radius",e.properties.RADIUS_BOTTOM_RIGHT/2+"px")),e.properties.GRADIENT_TYPE&&i.attr("data-grad-type",e.properties.GRADIENT_TYPE),e.properties.GRADIENT_ORIENTATION&&i.attr("data-grad-orient",e.properties.GRADIENT_ORIENTATION),e.properties.GRADIENT_RADIUS&&i.attr("data-grad-radius",e.properties.GRADIENT_RADIUS),e.properties.GRADIENT_COLOR_2&&i.attr("data-color2",e.properties.GRADIENT_COLOR_2),$("<div class='panelItem'>").appendTo(t));d.append($("<i class='fas fa-arrows-alt-v'>")),d.append($("<span class='panelName'>").text(e.name)),d.append($("<span class='panelPosition'>").text(localeLeft+": "+e.left+"%, "+localeTop+": "+e.top+"%, "+localeWidth+": "+e.width+"%, "+localeHeight+": "+e.height+"%")),d.append($("<span class='panelDisplay'>").text(""!==e.displayId?localeDisplay+" "+e.displayId:"")),d.dblclick(function(){showPanelEditDialog(a,i,d)}),i.append($("<span>").text(e.name)),a.length&&setupDragableDroppable(a,i,d)}function setupDragableDroppable(o,n,r){n.resizable({containment:o,handles:"all",snap:".panelSnap",snapTolerance:12,stop:function(){var t=o.width(),e=o.height(),a=n.position(),i=Math.round(100*n.width()*100/t)/100,d=Math.round(100*n.height()*100/e)/100,t=Math.round(100*a.left*100/t)/100,a=Math.round(100*a.top*100/e)/100;n.attr("data-width",i),n.attr("data-height",d),n.attr("data-left",t),n.attr("data-top",a),r.find("span.panelPosition").text(localeLeft+": "+t+"%, "+localeTop+": "+a+"%, "+localeWidth+": "+i+"%, "+localeHeight+": "+d+"%"),hookOnBeforeUnload()}}).draggable({containment:o,scroll:!1,snap:".panelSnap",snapTolerance:12,stop:function(){var t=o.width(),e=o.height(),a=n.position(),i=Math.round(100*n.width()*100/t)/100,d=Math.round(100*n.height()*100/e)/100,t=Math.round(100*a.left*100/t)/100,a=Math.round(100*a.top*100/e)/100;n.attr("data-width",i),n.attr("data-height",d),n.attr("data-left",t),n.attr("data-top",a),r.find("span.panelPosition").text(localeLeft+": "+t+"%, "+localeTop+": "+a+"%, "+localeWidth+": "+i+"%, "+localeHeight+": "+d+"%"),hookOnBeforeUnload()}}).dblclick(function(){showPanelEditDialog(o,n,r)}).fitText()}function showPanelEditDialog(t,i,d){var e=t.attr("data-width"),t=t.attr("data-height"),a=(document.getElementById("dialog-width").value=i.attr("data-width"),document.getElementById("dialog-height").value=i.attr("data-height"),document.getElementById("dialog-left").value=i.attr("data-left"),document.getElementById("dialog-top").value=i.attr("data-top"),document.getElementById("dialog-width-px").value=Math.round(e*document.getElementById("dialog-width").value/100),document.getElementById("dialog-height-px").value=Math.round(t*document.getElementById("dialog-height").value/100),document.getElementById("dialog-left-px").value=Math.round(e*document.getElementById("dialog-left").value/100),document.getElementById("dialog-top-px").value=Math.round(t*document.getElementById("dialog-top").value/100),document.getElementById("dialog-name").style.borderColor="#ccc",document.getElementById("dialog-name").value=i.attr("title"),document.getElementById("dialog-backgroundColor").value=i.attr("data-background-color"),document.getElementById("dialog-main").disabled=document.getElementById("dialog-main").checked="true"==i.attr("data-main"),document.getElementById("dialog-animationType").value=i.attr("data-animation-type")?i.attr("data-animation-type"):"NONE",document.getElementById("dialog-animationLength").value=i.attr("data-animation-length")?i.attr("data-animation-length"):0,document.getElementById("dialog-strokeWidth").value=i.attr("data-stroke-width")?i.attr("data-stroke-width"):0,document.getElementById("dialog-strokeColor").value=i.attr("data-stroke-color")?i.attr("data-stroke-color"):"#FFFFFF",document.getElementById("dialog-radiusTopLeft").value=i.attr("data-radius-top-left")?i.attr("data-radius-top-left"):0,document.getElementById("dialog-radiusTopRight").value=i.attr("data-radius-top-right")?i.attr("data-radius-top-right"):0,document.getElementById("dialog-radiusBottomLeft").value=i.attr("data-radius-bottom-left")?i.attr("data-radius-bottom-left"):0,document.getElementById("dialog-radiusBottomRight").value=i.attr("data-radius-bottom-right")?i.attr("data-radius-bottom-right"):0,document.getElementById("dialog-gradType").value=i.attr("data-grad-type")?i.attr("data-grad-type"):"",document.getElementById("dialog-gradOrient").value=i.attr("data-grad-orient")?i.attr("data-grad-orient"):"TOP_BOTTOM",document.getElementById("dialog-gradRadius").value=i.attr("data-grad-radius")?i.attr("data-grad-radius"):10,document.getElementById("dialog-color2").value=i.attr("data-color2")?i.attr("data-color2"):"#0000FF",document.getElementById("dialog-displayId")&&(document.getElementById("dialog-displayId").value=i.attr("data-display-id")?i.attr("data-display-id"):""),onGradientTypeSelectChanged(document.getElementById("dialog-gradType").value),$(".color-picker").colourpicker({allowAlpha:!0}).trigger("paste.colourpicker"),{});a[localeSave]=function(){var t,e=document.getElementById("dialog-name").value,a=findPanelWithName(e);a.length&&!a.get(0).isSameNode(i.get(0))?document.getElementById("dialog-name").style.borderColor="#e22":(document.getElementById("dialog-main").checked&&($(".panelDiv[data-main='true']").attr("data-main","false"),i.attr("data-main","true")),(a=document.getElementById("dialog-displayId")?document.getElementById("dialog-displayId").value:"")!==i.attr("data-display-id")&&(i.hasClass("ui-resizable")&&i.resizable("destroy").draggable("destroy").unbind("dblclick"),i.detach(),t=""===a?$(".layoutBuilder.mainDisplay"):$("#tabs-"+a+" .layoutBuilder"),i.appendTo(t),setupDragableDroppable(t,i,d)),i.attr("data-display-id",a),d.find("span.panelDisplay").text(""!==a?localeDisplay+" "+a:""),i.attr("title",e),i.find("span").first().text(e),d.find("span.panelName").text(e),d.find("span.panelPosition").text(localeLeft+": "+document.getElementById("dialog-left").value+"%, "+localeTop+": "+document.getElementById("dialog-top").value+"%, "+localeWidth+": "+document.getElementById("dialog-width").value+"%, "+localeHeight+": "+document.getElementById("dialog-height").value+"%"),setPanelColor(i,document.getElementById("dialog-backgroundColor").value),i.attr("data-animation-type",document.getElementById("dialog-animationType").value),i.attr("data-animation-length",document.getElementById("dialog-animationLength").value),i.attr("data-stroke-width",document.getElementById("dialog-strokeWidth").value),i.attr("data-stroke-color",document.getElementById("dialog-strokeColor").value),i.css("outline-width",document.getElementById("dialog-strokeWidth").value/2+"px"),i.css("outline-offset",document.getElementById("dialog-strokeWidth").value/-2+"px"),i.css("outline-color",document.getElementById("dialog-strokeColor").value),i.css("outline-style","solid"),i.attr("data-radius-top-left",document.getElementById("dialog-radiusTopLeft").value),i.css("border-top-left-radius",document.getElementById("dialog-radiusTopLeft").value/2+"px"),i.attr("data-radius-top-right",document.getElementById("dialog-radiusTopRight").value),i.css("border-top-right-radius",document.getElementById("dialog-radiusTopRight").value/2+"px"),i.attr("data-radius-bottom-left",document.getElementById("dialog-radiusBottomLeft").value),i.css("border-bottom-left-radius",document.getElementById("dialog-radiusBottomLeft").value/2+"px"),i.attr("data-radius-bottom-right",document.getElementById("dialog-radiusBottomRight").value),i.css("border-bottom-right-radius",document.getElementById("dialog-radiusBottomRight").value/2+"px"),i.attr("data-grad-type",document.getElementById("dialog-gradType").value),i.attr("data-grad-orient",document.getElementById("dialog-gradOrient").value),i.attr("data-grad-radius",document.getElementById("dialog-gradRadius").value),i.attr("data-color2",document.getElementById("dialog-color2").value),i.css("top",document.getElementById("dialog-top").value+"%"),i.css("left",document.getElementById("dialog-left").value+"%"),i.css("width",document.getElementById("dialog-width").value+"%"),i.css("height",document.getElementById("dialog-height").value+"%"),i.attr("data-top",document.getElementById("dialog-top").value),i.attr("data-left",document.getElementById("dialog-left").value),i.attr("data-width",document.getElementById("dialog-width").value),i.attr("data-height",document.getElementById("dialog-height").value),i.css("font-size",Math.min(i.width()/(1.5*i.text().length),.8*i.height())),hookOnBeforeUnload(),$(this).dialog("close"))},a[localeCancel]=function(){$(this).dialog("close")},a[localeDelete]=function(){i.remove(),d.remove(),hookOnBeforeUnload(),$(this).dialog("close")},0<i.attr("data-id").length&&(a[localePlaylistSchedule]=function(){window.location.href="/screen_layout/panel/schedule?panelId="+i.attr("data-id")}),setOnDimensionChange("left",e),setOnDimensionChange("top",t),setOnDimensionChange("width",e),setOnDimensionChange("height",t),$("#panelDialog").attr("title",i.attr("title")).dialog({resizable:!1,height:800,width:480,modal:!0,buttons:a})}function onGradientTypeSelectChanged(t){switch(t){case"":document.getElementById("row-color2").style.display="none",document.getElementById("row-gradRadius").style.display="none",document.getElementById("row-gradOrient").style.display="none";break;case"0":document.getElementById("row-color2").style.display="",document.getElementById("row-gradRadius").style.display="none",document.getElementById("row-gradOrient").style.display="";break;case"1":document.getElementById("row-color2").style.display="",document.getElementById("row-gradRadius").style.display="",document.getElementById("row-gradOrient").style.display="none"}}function addNewPanel(){for(var t="New",e=2;findPanelWithName(t).length;)t="New "+e++;var a={id:"",top:40,left:40,width:20,height:20,backgroundColor:"#000000",name:t,main:!1,properties:[],displayId:$("#tabs .ui-tabs-active a").attr("href").substring(6)};createPanelDiv($("#panelList"),a)}function findPanelWithName(t){return $(".panelDiv[title='"+t+"']")}function saveLayoutBuilder(){var a=$("#builderForm"),t=$(".layoutBuilder");t.width(),t.height();$(".panelDiv").each(function(t){var e=$(this);e.position();a.append("<input type='hidden' name='list["+t+"].id' value='"+e.attr("data-id")+"'/>"),a.append("<input type='hidden' name='list["+t+"].name' value='"+e.attr("title")+"'/>"),a.append("<input type='hidden' name='list["+t+"].width' value='"+e.attr("data-width")+"'/>"),a.append("<input type='hidden' name='list["+t+"].height' value='"+e.attr("data-height")+"'/>"),a.append("<input type='hidden' name='list["+t+"].left' value='"+e.attr("data-left")+"'/>"),a.append("<input type='hidden' name='list["+t+"].top' value='"+e.attr("data-top")+"'/>"),a.append("<input type='hidden' name='list["+t+"].displayOrder' value='"+t+"'/>"),a.append("<input type='hidden' name='list["+t+"].main' value='"+e.attr("data-main")+"'/>"),a.append("<input type='hidden' name='list["+t+"].backgroundColor' value='"+e.attr("data-background-color")+"'/>"),a.append("<input type='hidden' name='list["+t+"].displayId' value='"+e.attr("data-display-id")+"'/>"),e.attr("data-animation-type")&&a.append("<input type='hidden' name='list["+t+"].properties[\"ANIMATION_TYPE\"]' value='"+e.attr("data-animation-type")+"'/>"),e.attr("data-animation-length")&&a.append("<input type='hidden' name='list["+t+"].properties[\"ANIMATION_LENGTH\"]' value='"+e.attr("data-animation-length")+"'/>"),e.attr("data-stroke-width")&&a.append("<input type='hidden' name='list["+t+"].properties[\"STROKE_WIDTH\"]' value='"+e.attr("data-stroke-width")+"'/>"),e.attr("data-stroke-color")&&a.append("<input type='hidden' name='list["+t+"].properties[\"STROKE_COLOR\"]' value='"+e.attr("data-stroke-color")+"'/>"),e.attr("data-radius-top-left")&&a.append("<input type='hidden' name='list["+t+"].properties[\"RADIUS_TOP_LEFT\"]' value='"+e.attr("data-radius-top-left")+"'/>"),e.attr("data-radius-top-right")&&a.append("<input type='hidden' name='list["+t+"].properties[\"RADIUS_TOP_RIGHT\"]' value='"+e.attr("data-radius-top-right")+"'/>"),e.attr("data-radius-bottom-left")&&a.append("<input type='hidden' name='list["+t+"].properties[\"RADIUS_BOTTOM_LEFT\"]' value='"+e.attr("data-radius-bottom-left")+"'/>"),e.attr("data-radius-bottom-right")&&a.append("<input type='hidden' name='list["+t+"].properties[\"RADIUS_BOTTOM_RIGHT\"]' value='"+e.attr("data-radius-bottom-right")+"'/>"),e.attr("data-grad-type")&&a.append("<input type='hidden' name='list["+t+"].properties[\"GRADIENT_TYPE\"]' value='"+e.attr("data-grad-type")+"'/>"),e.attr("data-grad-orient")&&a.append("<input type='hidden' name='list["+t+"].properties[\"GRADIENT_ORIENTATION\"]' value='"+e.attr("data-grad-orient")+"'/>"),e.attr("data-grad-radius")&&a.append("<input type='hidden' name='list["+t+"].properties[\"GRADIENT_RADIUS\"]' value='"+e.attr("data-grad-radius")+"'/>"),e.attr("data-color2")&&a.append("<input type='hidden' name='list["+t+"].properties[\"GRADIENT_COLOR_2\"]' value='"+e.attr("data-color2")+"'/>")}),beforeUnloadActive=!1}function isDark(t){t=t.substring(1);t=parseInt(t,16);return.2126*(t>>16&255)+.7152*(t>>8&255)+.0722*(t>>0&255)<40}function setPanelColor(t,e){t.css("background-color",e.substring(0,7));var a=45*($(".panelDiv").index(t)+1)%360;t.css("background-image","repeating-linear-gradient("+a+(isDark(e)?"deg, transparent, transparent 6px, rgba(255,255,255,.3) 6px, rgba(255,255,255,.3) 12px)":"deg, transparent, transparent 6px, rgba(0,0,0,.3) 6px, rgba(0,0,0,.3) 12px)")),t.css("color","#"+(16777215^Number("0x1"+e.substring(1,7))).toString(16).substr(1).toUpperCase()),t.attr("data-background-color",e)}!function(a){a.fn.fitText=function(t){return this.each(function(){function t(){e.css("font-size",Math.min(e.width()/(1.5*e.text().length),.8*e.height()))}var e=a(this);t(),a(window).on("resize.fittext orientationchange.fittext",t)})}}(jQuery),function(E){function T(t,e,a){return Math.abs(t)<a?-t:Math.abs(e)<a?-e:0}function a(t){return t.sort(function(t,e){return t?e?Math.abs(t)-Math.abs(e):-1:1})[0]}function d(t){return parseInt(t.css("margin-left"),10)||0}function o(t){return parseInt(t.css("margin-top"),10)||0}function t(t,e,a){var i=E.ui.resizable.prototype[t];E.ui.resizable.prototype[t]=function(){a&&a.apply(this,arguments),i.apply(this,arguments),e&&e.apply(this,arguments)}}E.extend(E.ui.resizable.prototype.options,{snapTolerance:20,snapMode:"both"}),E.ui.plugin.add("resizable","snap",{start:function(){var t=E(this),i=t.data("ui-resizable"),e=i.options.snap;i.ow=i.helper.outerWidth()-i.size.width,i.oh=i.helper.outerHeight()-i.size.height,i.lm=d(t),i.tm=o(t),i.coords=[],E("string"==typeof e?e:":data(ui-resizable)").each(function(){var t,e,a;this!=i.element[0]&&this!=i.helper[0]&&(e=(a=(t=E(this)).position()).left+d(t),a=a.top+o(t),i.coords.push({l:e,t:a,r:e+t.outerWidth(),b:a+t.outerHeight()}))})},resize:function(){var t,o=[],n=[],r=[],l=[],e=E(this).data("ui-resizable"),s=e.axis.split(""),p=e.options.snapTolerance,u=e.options.snapMode,h=e.position.left+e.lm,g=h-p,c=e.position.top+e.tm,m=c-p,y=h+e.size.width+e.ow,f=y+p,I=c+e.size.height+e.oh,v=I+p;E.each(e.coords,function(){var a=this,i=Math.min(f,a.r)-Math.max(g,a.l),d=Math.min(v,a.b)-Math.max(m,a.t);i<0||d<0||E.each(s,function(t,e){if("outer"==u)switch(e){case"w":case"e":if(2*p<i)return;break;case"n":case"s":if(2*p<d)return}else if("inner"==u)switch(e){case"w":case"e":if(i<2*p)return;break;case"n":case"s":if(d<2*p)return}switch(e){case"w":o.push(T(h-a.l,h-a.r,p));break;case"n":n.push(T(c-a.t,c-a.b,p));break;case"e":r.push(T(y-a.l,y-a.r,p));break;case"s":l.push(T(I-a.t,I-a.b,p))}})}),l.length&&(e.size.height+=a(l)),r.length&&(e.size.width+=a(r)),o.length&&(t=a(o),e.position.left+=t,e.size.width-=t),n.length&&(t=a(n),e.position.top+=t,e.size.height-=t)}}),t("_mouseStop",null,function(){this._helper&&(this.position={left:parseInt(this.helper.css("left"),10)||.1,top:parseInt(this.helper.css("top"),10)||.1},this.size={width:this.helper.outerWidth(),height:this.helper.outerHeight()})}),t("_mouseStart",function(){this._helper&&(this.size={width:this.size.width-(this.helper.outerWidth()-this.helper.width()),height:this.size.height-(this.helper.outerHeight()-this.helper.height())},this.originalSize={width:this.size.width,height:this.size.height})}),t("_renderProxy",function(){this._helper&&this.helper.css({left:this.elementOffset.left,top:this.elementOffset.top,width:this.element.outerWidth(),height:this.element.outerHeight()})});var i=E.ui.resizable.prototype.plugins.resize;E.each(i,function(t,e){if("ghost"==e[0])return i.splice(t,1),!1}),E.each(E.ui.resizable.prototype.plugins.start,function(t,e){var a;if("ghost"==e[0])return a=e[1],!(e[1]=function(){a.apply(this,arguments),E(this).data("ui-resizable").ghost.css({width:"100%",height:"100%"})})})}(jQuery),$(function(){$("#tabs").tabs({activate:function(){$(".panelDiv").each(function(){var t=$(this);t.css("font-size",Math.min(t.width()/(1.5*t.text().length),.8*t.height()))})}});var d=$(".layoutBuilder").first().width(),e=($(".layoutBuilder").each(function(){var t=$(this),e=t.attr("data-width"),a=t.attr("data-height"),i=d*a/e;750<i?(t.height(750),t.width(750*e/a)):i<200?(t.height(200),t.width(200*e/a)):(t.height(i),t.width(d))}),$("#panelList"));panels.forEach(function(t){createPanelDiv(e,t)}),$("#panelList").sortable({placeholder:"ui-state-highlight",start:function(t,e){e.item.data("startPos",e.item.index())},update:function(t,e){var a,i=e.item.data("startPos"),e=e.item.index(),d=$(".panelDiv").eq(i).get(0);e<i?(a=$(".panelDiv").eq(e).get(0),d.parentNode.insertBefore(d,a)):(a=$(".panelDiv").eq(e).get(0),d.parentNode.insertBefore(d,a.nextSibling))}})});var onBeforeUnloadHooked=!1,beforeUnloadActive=!0;function hookOnBeforeUnload(){onBeforeUnloadHooked||(window.onbeforeunload=function(t){return beforeUnloadActive?(t.preventDefault(),t.returnValue="Do you want to exit without saving the layout?"):null},onBeforeUnloadHooked=!0)}